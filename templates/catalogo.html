{% extends "base.html" %}
{% block title %}Catálogo{% endblock %}
{% block content %}

<div class="container my-5">
  <h2 class="text-center mb-4">Catálogo de Productos</h2>
  <div class="row g-4">
    {% for p in products %}
    <div class="col-md-3">
      <div class="card h-100 shadow-sm product-card">

        <!-- Imagen clickeable para agrandar -->
        {% set img_path = 'img/' ~ p.foto_producto if p.foto_producto else 'img/no-image.png' %}
        <img 
          src="{{ url_for('static', filename=img_path) }}"
          class="card-img-top img-click"
          alt="{{ p.nombre }}"
          style="height:250px;object-fit:cover; cursor:pointer;"
          data-img="{{ url_for('static', filename=img_path) }}"
        >
        
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-center">{{ p.nombre }}</h5>
          <p class="card-text text-muted small">{{ p.descripcion }}</p>
          <p class="price text-center fw-bold">
            ${{ "%.2f"|format(p.precio_producto) }}
          </p>

          <!-- Formulario para añadir al carrito -->
          <form action="{{ url_for('carrito.add_to_cart', product_id=p.id_producto) }}" method="POST">
            <div class="d-flex justify-content-center mb-2">
              <select name="talla" class="form-select form-select-sm" required>
                <option value="">Talla</option>
                <option value="S">S</option>
                <option value="M">M</option>
                <option value="L">L</option>
                <option value="XL">XL</option>
              </select>
            </div>
            <button type="submit" class="btn btn-dark w-100">Añadir al carrito</button>
          </form>

          <!-- Boton reseñas -->
          <a href="{{ url_for('productos.detalle_producto', id_producto=p.id_producto) }}" 
              class="btn btn-outline-primary btn-sm">
            Ver detalles y reseñas
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Modal para ampliar la imagen -->
<div class="modal fade" id="imgModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark">
      <div class="modal-body p-0 text-center">
        <!-- Ajuste de tamaño máximo -->
        <img id="modalImg" src="" class="img-fluid rounded" 
             style="max-width:90vw; max-height:80vh; object-fit:contain;">
      </div>
    </div>
  </div>
</div>

<!-- Script para activar el modal -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".img-click").forEach(img => {
    img.addEventListener("click", function () {
      const url = this.getAttribute("data-img");
      document.getElementById("modalImg").src = url;
      const modal = new bootstrap.Modal(document.getElementById('imgModal'));
      modal.show();
    });
  });
});
</script>

{% endblock %}
